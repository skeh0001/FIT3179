{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
      "url": "js/ne_110m_admin_0_countries.topojson",
      "format": {
            "type": "topojson",
            "feature": "ne_110m_admin_0_countries"
          }
    },
  "vconcat": [
      {
          "title": "Medals per athlete by Country",
          "width": 1000,
          "height": 600,
          "projection": {
              "type": "equirectangular",
              "rotate": [-120, 0, 0]
          },
          "layer": [
              {
                  "transform": [{"calculate": "'Data is not available in ' + datum.properties.NAME",
                      "as": "note"}],
                  "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
                  "encoding": {"tooltip": {"field": "note"}}
              },
              {
                  "params": [
                      {
                          "name": "brush",
                          "select": {"type": "point", "on": "click", "fields": ["properties.NAME"]}
                      }
                  ],
                  "transform": [{
                      "lookup": "properties.NAME",
                      "from": {
                          "data": {
                          "url": "data/country_medals.csv"
                          },
                          "key": "Country",
                          "fields": ["Bronze", "Silver", "Gold", "Athletes"]
                      }
                      },
                      {"calculate": "(toNumber(datum.Bronze) + toNumber(datum.Silver) + toNumber(datum.Gold))/datum.Athletes", "as": "Medal Proportion"}
                  ],
                  "mark": {
                      "type": "geoshape",
                      "stroke": "white"
                      },
                  "encoding": {
                      "color": {
                          "field": "Medal Proportion",
                          "type": "quantitative",
                          "scale": {"scheme": "blues"}
                      },
                      "stroke": {
                          "condition": {
                              "param": "brush",
                              "empty": false,
                              "value": "black"
                          },
                          "value": "white"
                      },
                      "tooltip": [
                          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
                          {"field": "Medal Proportion", "type": "quantitative", "format": ".3f"},
                          {"field": "Bronze", "type": "quantitative"},
                          {"field": "Silver", "type": "quantitative"},
                          {"field": "Gold", "type": "quantitative"},
                          {"field": "Athletes", "type": "quantitative"}
              ]
            }
          }
          ]  
      },
      {
          "title": "Medals for each country over the years",
          "width": 1000,
          "height": 200,
          "data": {"url": "data/country_medals_long.csv"},
          "transform": [
              {"calculate": "datum.Country", "as": "properties.NAME"},
              {"filter": {"param": "brush"}}
          ],
          "mark": "bar",
          "encoding": {
              "x": {"aggregate": "sum", "field": "Count", "title": "Total Medals"},
              "y": {"field": "properties.NAME", "title": "Country"},
              "color": {
                  "field": "Medal",
                  "type": "ordinal",
                  "scale": {
                      "domain": ["Bronze", "Silver", "Gold"],
                      "range": ["#CD7F32", "#C0C0C0", "#FFD700"]
                  }
              },
              "tooltip": [
                  {"field": "properties.NAME", "title": "Country"},
                  {"field": "Bronze"},
                  {"field": "Silver"},
                  {"field": "Gold"}
              ]
          }
      }
  ]
  
}
