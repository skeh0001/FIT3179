{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "https://raw.githubusercontent.com/KaneSec/vega_lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
      "format": {
            "type": "topojson",
            "feature": "ne_110m_admin_0_countries"
          }
    },
    "vconcat": [
      {
       "title": "Medals per athlete by Country",
        "width": 1000,
        "height": 600,
        "projection": {
          "type": "equirectangular",
          "rotate": [-120, 0, 0]
        },
        "layer": [
          {
            "transform": [{"calculate": "'Data is not available in ' + datum.properties.NAME",
              "as": "note"}],
            "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
            "encoding": {"tooltip": {"field": "note"}}
          },
          {
            "transform": [
              {
                "lookup": "properties.NAME",
                "from": {
                  "data": {
                    "url": "https://raw.githubusercontent.com/skeh0001/FIT3179/main/country_medals.csv"
                },
                "key": "Country",
                "fields": ["Bronze", "Silver", "Gold", "Athletes"]
                }
              },
              {
                "calculate": "(toNumber(datum.Bronze) + toNumber(datum.Silver) + toNumber(datum.Gold))/datum.Athletes", 
                "as": "Medal Proportion"
              },
              {
                "calculate": "datum.properties.NAME", "as": "Country"
              }
            ],
            "params": [
              {
                "name": "brush",
                "select": {"type": "point", "on": "click", "fields": ["Country"]},
                "value": {"Country": ["Australia", "China", "United States of America"]}
              }
            ],
            "mark": {
              "type": "geoshape"
              },
            "encoding": {
              "color": {
                "field": "Medal Proportion",
                "type": "quantitative",
                "scale": {"scheme": "blues"}
              },
              "stroke": {
                "condition": {
                  "param": "brush",
                  "empty": false,
                  "value": "black"
                },
                "value": "white"
              },
              "strokeWidth" : {
                "condition": {
                  "param": "brush",
                  "empty": false,
                  "value": 3
                },
                "value": 1
              },
              "tooltip": [
                {"field": "properties.NAME", "type": "nominal", "title": "Country"},
                {"field": "Medal Proportion", "type": "quantitative", "format": ".3f"},
                {"field": "Bronze", "type": "quantitative"},
                {"field": "Silver", "type": "quantitative"},
                {"field": "Gold", "type": "quantitative"},
                {"field": "Athletes", "type": "quantitative"}
              ]
            } 
          }
        ]
      },
        {
            "title": "Medals for each country over the years (shift + click on the map to select countries)",
            "width": 1000,
            "height": 200,
            "data": {"url": "https://raw.githubusercontent.com/skeh0001/FIT3179/main/country_medals_long.csv"},
            "transform": [
              {"filter": {"param": "brush"}}
            ],
            "mark": "bar",
            "encoding": {
              "x": {"aggregate": "sum", "field": "Count", "title": "Total Medals"},
              "y": {"field": "Country"},
              "color": {
                "field": "Medal",
                "type": "ordinal",
                "scale": {
                  "domain": ["Bronze", "Silver", "Gold"],
                  "range": ["#CD7F32", "#C0C0C0", "#FFD700"]
                }
              },
              "tooltip": [
                {"field": "Country"},
                {"field": "Medal"},
                {"aggregate": "sum", "field": "Count", "title": "Amount"}
              ]
            }
        }
    ]
  }